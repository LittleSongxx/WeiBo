# Topicèˆ†æƒ…åˆ†æç³»ç»Ÿ - å¯åŠ¨æŒ‡å—

## å¿«é€Ÿå¯åŠ¨ï¼ˆå¤åˆ¶ç²˜è´´åˆ°4ä¸ªç»ˆç«¯ï¼‰

### å‰ç½®å‡†å¤‡
```bash
# 1. å¯åŠ¨DockeræœåŠ¡
cd ~/code/graduation/Topic_and_user_profile_analysis_system
docker-compose up -d

# 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
# åº”è¯¥çœ‹åˆ°: redis, mongodb, elasticsearch ä¸‰ä¸ªæœåŠ¡ Up çŠ¶æ€
```

### ç»ˆç«¯1: åç«¯API
```bash
cd ~/code/graduation/Topic_and_user_profile_analysis_system/code/back_end
source ~/miniconda3/etc/profile.d/conda.sh && conda activate graduation
python main.py
```

### ç»ˆç«¯2: Celery Worker
```bash
cd ~/code/graduation/Topic_and_user_profile_analysis_system/code/back_end
source ~/miniconda3/etc/profile.d/conda.sh && conda activate graduation
celery -A celery_task.worker worker --loglevel=info -P threads
```

### ç»ˆç«¯3: å¾®åšçˆ¬è™«API
```bash
cd ~/code/graduation/Topic_and_user_profile_analysis_system/code/weibo_crawler
source ~/miniconda3/etc/profile.d/conda.sh && conda activate graduation
python weibo_curl_api.py
```

### ç»ˆç«¯4: å‰ç«¯æœåŠ¡
```bash
cd ~/code/graduation/Topic_and_user_profile_analysis_system/code/front_end
npm run serve
```

## è®¿é—®åœ°å€

- ğŸŒ **å‰ç«¯é¡µé¢**: http://localhost:8080
- ğŸ“¡ **åç«¯API**: http://127.0.0.1:8181/docs
- ğŸ•·ï¸ **çˆ¬è™«API**: http://127.0.0.1:8001

## æµ‹è¯•å‘½ä»¤

```bash
# åˆ›å»ºè¯é¢˜åˆ†æä»»åŠ¡ï¼ˆæ¨èï¼šé™åˆ¶3-5é¡µé¿å…åçˆ¬ï¼‰
curl "http://127.0.0.1:8181/api/tag/add_task?tag=æ˜¥èŠ‚&is_hot=true&page_num=3"

# æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨
curl "http://127.0.0.1:8181/api/tag/tag_list"

# æŸ¥çœ‹Celeryä»»åŠ¡æ‰§è¡Œæ—¥å¿—
tail -f ~/code/graduation/Topic_and_user_profile_analysis_system/code/back_end/celery.log
```

## å¸¸è§é—®é¢˜æ’æŸ¥

### å‰ç«¯æ²¡æœ‰æ˜¾ç¤ºçƒ­åº¦å›¾/å…³ç³»å›¾
**ç—‡çŠ¶**: åªæ˜¾ç¤º10æ¡å¾®åšå’Œè¯äº‘ï¼Œå…¶ä»–éƒ¨åˆ†ç©ºç™½

**åŸå› **: 
1. **æœç´¢é¡µæ•°è¿‡å¤šè§¦å‘åçˆ¬**ï¼ˆå¦‚12é¡µï¼‰â†’ è¿”å›ç©ºæ•°æ®
2. **è¯„è®ºçˆ¬å–å¤±è´¥**ï¼ˆCookie invalidï¼‰â†’ æ²¡æœ‰è¯„è®ºæ•°æ®æ— æ³•èšç±»

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
ps aux | grep -E "weibo_curl_api|celery.*worker"

# 2. è§‚å¯ŸCeleryæ—¥å¿—ï¼ˆå¦‚æœçˆ¬è™«ä»»åŠ¡<1ç§’ç»“æŸè¯´æ˜æ²¡æ•°æ®ï¼‰
tail -f ~/code/graduation/Topic_and_user_profile_analysis_system/code/back_end/celery.log

# 3. é‡æ–°æœç´¢ï¼Œé™åˆ¶3-5é¡µ
# åœ¨å‰ç«¯æœç´¢æ¡†è¾“å…¥: "æ˜¥èŠ‚" æˆ– "AIæŠ€æœ¯"ï¼Œåªæœç´¢å‰3é¡µ
```

### weibo_curl_apiè¿”å›Cookie invalid
**ç—‡çŠ¶**: Celeryæ—¥å¿—æ˜¾ç¤º "Warning: å¾®åšxxxçˆ¬å–å¤±è´¥: Cookie invalid."

**åŸå› **: Cookieè¿‡æœŸ

**è§£å†³æ–¹æ¡ˆï¼ˆåªéœ€PCç«¯Cookieï¼‰**:
```bash
# 1. è·å–PCç«¯Cookie
# è®¿é—® https://s.weibo.com æˆ– https://weibo.com
# ç™»å½•åï¼ŒF12 â†’ Network â†’ å¤åˆ¶ä»»æ„è¯·æ±‚çš„Cookie

# 2. æ›´æ–°é…ç½®
cd ~/code/graduation/Topic_and_user_profile_analysis_system/code/weibo_crawler
nano account/account.json
# ç²˜è´´åˆšæ‰å¤åˆ¶çš„Cookieåˆ° "cookies" æ•°ç»„

# 3. é‡å¯weibo_curl_api
pkill -f weibo_curl_api
source ~/miniconda3/etc/profile.d/conda.sh && conda activate graduation
python weibo_curl_api.py

# 4. éªŒè¯Cookieæœ‰æ•ˆ
curl "http://127.0.0.1:8001/weibo_curl/api/search_tweets?keyword=æµ‹è¯•&cursor=1"
```

**æ³¨æ„**ï¼šç³»ç»Ÿå·²å‡çº§ä¸ºç»Ÿä¸€ä½¿ç”¨PCç«¯Cookieï¼Œä¸å†éœ€è¦ç§»åŠ¨ç«¯Cookieï¼ˆ_T_WMå­—æ®µï¼‰ï¼

**å¿«æ·æ›´æ–°Cookieè„šæœ¬**ï¼š
```bash
# æ–¹å¼1ï¼šä½¿ç”¨è‡ªåŠ¨æ›´æ–°è„šæœ¬ï¼ˆæ¨èï¼‰
cd ~/code/graduation/Topic_and_user_profile_analysis_system/code/weibo_crawler
python update_cookie.py  # æ ¹æ®æç¤ºç²˜è´´PCç«¯Cookie

# æ–¹å¼2ï¼šæ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶
nano account/account.json
```

## åœæ­¢æœåŠ¡

```bash
# åœæ­¢DockeræœåŠ¡
cd ~/code/graduation/Topic_and_user_profile_analysis_system
docker-compose down

# å„ç»ˆç«¯æŒ‰ Ctrl+C åœæ­¢å¯¹åº”æœåŠ¡
```

## æ³¨æ„äº‹é¡¹

1. **æ‰€æœ‰Pythonå‘½ä»¤å¿…é¡»åœ¨graduationç¯å¢ƒä¸­è¿è¡Œ**
2. **é¦–æ¬¡è¿è¡Œéœ€è¦é…ç½®Cookie**: ç¼–è¾‘ `code/weibo_crawler/account/account.json`
3. **å‚æ•°åç§°**: APIä¸­ä½¿ç”¨ `tag`ï¼ˆä¸æ˜¯ `tag_text`ï¼‰
